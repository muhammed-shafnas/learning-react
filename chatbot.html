<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
  </head>
  <body class="font-arial my-[0px]">
    <div class="js-container"></div>

   
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
     
    <script type="text/babel">
        
        function ChatInput({chatMessages, setChatMessages}) {
          const [inputText, setInputText] = React.useState('');

          function saveInputText(event) {
            setInputText(event.target.value)
          }

          function sendMessage() {
            const newChatMessages = [
              ...chatMessages,
              {
                message: inputText,
                sender: 'user',
                id: crypto.randomUUID()
              }
            ]
             setChatMessages(newChatMessages);

            const response = Chatbot.getResponse(inputText);
            
             setChatMessages([
              ...newChatMessages,
              {
                message: response,
                sender: 'robot',
                id: crypto.randomUUID()
              }
            ]);

            setInputText('');
          }
          return (
            <div class="flex ">
              <input 
                placeholder = "Send a message to Chatbot" 
                size = "30"
                onChange={saveInputText}
                value={inputText}
                class="py-[12px] px-[15px] rounded-[10px] border-[1px] text-[15px] mt-[10px] ml-[10px] flex-grow mb-[60px] "
              />
              <button onClick={sendMessage} class="bg-green-500 text-black px-[20px]  ml-[10px] outline-none rounded-[10px] cursor-pointer font-semibold ">
                Send
              </button>
            </div>
          );
        }

        function ChatMessage({ message, sender}) {
          // const sender = props.sender;
          // const message = props.message;
          // const { message, sender } = props;

          // if (sender === 'robot') {
          //   return(
          //      <div>
          //     <img src ="robot.png" width="50"/>
          //     {message}
          //   </div>
          //   );
          // }

          const responseImage = "w-[45px] ";

          return (
            <div class={sender == 'user'
              ? "flex justify-end items-start"
              : "flex justify-start items-start"
             }>
              {sender === 'robot' && (
                <img src ="robot.png" class={responseImage}/>
              )}
              <div class="bg-gray-200 py-[15px] px-[20px] rounded-[10px] mx-[10px] mb-[20px] max-w-[300px]">
                {message}
              </div>
              {sender === 'user' && (
                <img src ="user.png" class={responseImage}/>
              )}
            </div>
          ); 
        }
        
        function ChatMessages({chatMessages}) {
         
          const chatMessagesRef = React.useRef(null);

         React.useEffect(() => {
            const containerElem = chatMessagesRef.current
            if (containerElem) {
              containerElem.scrollTop = containerElem.scrollHeight;
            }
         }, [chatMessages]);

          return (
             <div class="flex-grow-1 mt-[20px] overflow-y-auto "
             ref={chatMessagesRef}>

                { chatMessages.map((chatMessage) => {
                    return (
                      <ChatMessage 
                      message={chatMessage.message}
                      sender={chatMessage.sender}
                      key={chatMessage.id}
                      />
                    );
                })}
                 
              </div>
          );
        }

        function App() {
           const [chatMessages, setChatMessages] = React.useState(
            [{
            message: 'hello chatbot',
            sender: 'user',
            id: 'id1'
          }, {
            message: 'Hello! How can I help you?',
            sender: 'robot',
            id: 'id2'
          }, {
            message: 'can you get me todays date?',
            sender: 'user',
            id: 'id3'
          }, {
            message: 'Today is September 27',
            sender: 'robot',
            id: 'id4'
          }]
          );
          // const [chatMessages, setChatMessages] = array;
          // const chatMessages = array[0];
          // const setChatMessages = array[1];

          return (
            <div class="max-w-[600px] mx-auto h-[100vh] flex flex-col">
             
              <ChatMessages 
                chatMessages={chatMessages}
              />
               <ChatInput 
                chatMessages={chatMessages}
                setChatMessages={setChatMessages}
              />
            </div>
          )

          
        }
        
        const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>